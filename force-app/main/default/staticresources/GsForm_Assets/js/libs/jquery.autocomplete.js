(function(e){function n(e,n,r){var i="("+r.replace(t,"\\$1")+")";return e.replace(new RegExp(i,"gi"),"<strong>$1</strong>")}function r(t,r){this.el=e(t),this.el.attr("autocomplete","off"),this.suggestions=[],this.data=[],this.badQueries=[],this.selectedIndex=-1,this.currentValue=this.el.val(),this.intervalId=0,this.cachedResponse=[],this.onChangeInterval=null,this.onChange=null,this.ignoreValueChange=!1,this.serviceUrl=r.serviceUrl,this.isLocal=!1,this.options={autoSubmit:!1,minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:!0,params:{},fnFormatResult:n,delimiter:null,zIndex:9999},this.initialize(),this.setOptions(r),this.el.data("autocomplete",this)}var t=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g");e.fn.autocompleteSearch=function(t,n){var i;return typeof t=="string"?(i=this.data("autocomplete"),typeof i[t]=="function"&&i[t](n)):i=new r(this.get(0)||e("<input />"),t),i},r.prototype={killerFn:null,initialize:function(){var t,n,r;t=this,n=Math.floor(Math.random()*1048576).toString(16),r="Autocomplete_"+n,this.killerFn=function(n){e(n.target).parents(".autocomplete").size()===0&&(t.killSuggestions(),t.disableKillerFn())},this.options.width||(this.options.width=this.el.width()),this.mainContainerId="AutocompleteContainter_"+n,e('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="'+r+'" style="display:none; width:300px;"></div></div></div>').appendTo("body"),this.container=e("#"+r),this.fixPosition(),window.opera?this.el.keypress(function(e){t.onKeyPress(e)}):this.el.keydown(function(e){t.onKeyPress(e)}),this.el.keyup(function(e){t.onKeyUp(e)}),this.el.blur(function(){t.enableKillerFn()}),this.el.focus(function(){t.fixPosition()}),this.el.change(function(){t.onValueChanged()})},extendOptions:function(t){e.extend(this.options,t)},setOptions:function(t){var n=this.options;this.extendOptions(t),n.extraWidth&&(n.width+=n.extraWidth);if(n.lookup||n.isLocal)this.isLocal=!0,e.isArray(n.lookup)&&(n.lookup={suggestions:n.lookup,data:[]});e("#"+this.mainContainerId).css({zIndex:n.zIndex}).addClass(n.className),this.container.css({maxHeight:n.maxHeight+"px",width:n.width})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var t=this.el.offset(),n=t.left,r=t.top+this.el.innerHeight();this.options.leftMargin&&this.el.attr("id")==="header-search"&&e("html").hasClass("csstransitions")&&(n+=this.options.leftMargin),this.options.topMargin&&(r+=this.options.topMargin),e("#"+this.mainContainerId).css({top:r+"px",left:n+"px"})},enableKillerFn:function(){var t=this;e(document).bind("click",t.killerFn)},disableKillerFn:function(){var t=this;e(document).unbind("click",t.killerFn)},killSuggestions:function(){var e=this;this.stopKillSuggestions(),this.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onValueChanged:function(){this.change(this.selectedIndex)},onKeyPress:function(e){if(this.disabled||!this.enabled)return;switch(e.keyCode){case 27:this.el.val(this.currentValue),this.hide();break;case 9:case 13:if(this.selectedIndex===-1){this.hide();return}this.select(this.selectedIndex);if(e.keyCode===9)return;break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()},onKeyUp:function(e){if(this.disabled)return;switch(e.keyCode){case 38:case 40:return}clearInterval(this.onChangeInterval);if(this.currentValue!==this.el.val())if(this.options.deferRequestBy>0){var t=this;this.onChangeInterval=setInterval(function(){t.onValueChange()},this.options.deferRequestBy)}else this.onValueChange()},onValueChange:function(){clearInterval(this.onChangeInterval),this.currentValue=this.el.val();var e=this.getQuery(this.currentValue);this.selectedIndex=-1;if(this.ignoreValueChange){this.ignoreValueChange=!1;return}e===""||e.length<this.options.minChars?this.hide():this.getSuggestions(e)},getQuery:function(t){var n,r;return n=this.options.delimiter,n?(r=t.split(n),e.trim(r[r.length-1])):e.trim(t)},getSuggestionsLocal:function(e){var t,n,r,i,s;n=this.options.lookup,r=n.suggestions.length,t={suggestions:[],data:[]},e=e.toLowerCase();for(s=0;s<r;s++)i=n.suggestions[s],i.toLowerCase().indexOf(e)===0&&(t.suggestions.push(i),t.data.push(n.data[s]));return t},getSuggestions:function(t){var n,r;n=this.isLocal?this.getSuggestionsLocal(t):this.cachedResponse[t],n&&e.isArray(n.suggestions)?(this.suggestions=n.suggestions,this.data=n.data,this.suggest()):this.isBadQuery(t)?this.hide():(r=this,r.options.params.q=encodeURIComponent(t),e.ajax({url:this.serviceUrl,dataType:"jsonp",data:r.options.params,success:function(e){r.processResponse(e)}}))},isBadQuery:function(e){var t=this.badQueries.length;while(t--)if(e.indexOf(this.badQueries[t])===0)return!0;return!1},hide:function(){this.enabled=!1,this.selectedIndex=-1,this.container.hide()},suggest:function(){if(this.suggestions.length===0){this.hide();return}var t,n,r,i,s,o,u,a,f;t=this,n=this.suggestions.length,i=this.options.fnFormatResult,s=this.getQuery(this.currentValue),a=function(e){return function(){t.activate(e)}},f=function(e){return function(){t.select(e)}},this.container.hide().empty();for(o=0;o<n;o++)u=this.suggestions[o],r=e((t.selectedIndex===o?'<div class="selected"':"<div")+' title="'+u+'">'+i(u,this.data[o],s)+"</div>"),r.mouseover(a(o)),r.click(f(o)),this.container.append(r);this.enabled=!0,this.container.show()},processResponse:function(e){if(e.length<2)return;var t=e[0],n=e[1];this.options.noCache||(this.cachedResponse[t]=e,n.length===0&&this.badQueries.push(t)),t.toLowerCase()===this.getQuery(this.currentValue).toLowerCase()&&(this.suggestions=n,this.data=[],this.suggest())},activate:function(t){var n,r;return n=this.container.children(),this.selectedIndex!==-1&&n.length>this.selectedIndex&&e(n.get(this.selectedIndex)).removeClass(),this.selectedIndex=t,this.selectedIndex!==-1&&n.length>this.selectedIndex&&(r=n.get(this.selectedIndex),e(r).addClass("selected")),r},deactivate:function(e,t){e.className="",this.selectedIndex===t&&(this.selectedIndex=-1)},select:function(e){var t,n;t=this.suggestions[e],t&&(this.el.val(t),this.options.autoSubmit&&(n=this.el.parents("form"),n.length>0&&n.get(0).submit()),this.ignoreValueChange=!0,this.hide(),this.onSelect(e))},change:function(t){var n,r,i;i=this,n=this.suggestions[t];if(n){var s,o;s=i.suggestions[t],o=i.data[t],i.el.val(i.getValue(s))}else s="",o=-1;r=i.options.onChange,e.isFunction(r)&&r(s,o,i.el)},moveUp:function(){if(this.selectedIndex===-1)return;if(this.selectedIndex===0){this.container.children().get(0).className="",this.selectedIndex=-1,this.el.val(this.currentValue);return}this.adjustScroll(this.selectedIndex-1)},moveDown:function(){if(this.selectedIndex===this.suggestions.length-1)return;this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(e){var t,n,r,i;t=this.activate(e),n=t.offsetTop,r=this.container.scrollTop(),i=r+this.options.maxHeight-25,n<r?this.container.scrollTop(n):n>i&&this.container.scrollTop(n-this.options.maxHeight+25),this.el.val(this.getValue(this.suggestions[e]))},onSelect:function(t){var n,r,i,s;n=this,r=n.options.onSelect,i=n.suggestions[t],s=n.data[t],n.el.val(n.getValue(i)),e.isFunction(r)&&r(i,s,n.el)},getValue:function(e){var t,n,r,i;return i=this,t=i.options.delimiter,t?(n=i.currentValue,r=n.split(t),r.length===1?e:n.substr(0,n.length-r[r.length-1].length)+e):e}}})(jQuery);