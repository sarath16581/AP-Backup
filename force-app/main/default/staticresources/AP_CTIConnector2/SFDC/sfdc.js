define(["jquery","util","Glue","integration","i18next","jqueryI18next","i18nextXHRBackend","SFDC/connected","SFDC/lang"],function(e,n,o,t,s,a,l,c,i){function r(){console.log(d+"start"),t.interaction.cti.getCallCenterSettings(function(a){console.log(d+"getCallCenterSettings");console.log(a);var l=e.parseJSON(a.result);S=u(l);var i=p(l);n.getInstance("glue.state").subscribe(function(e){switch(e){case"connecting":console.log(d+"Connecting..."),t.console.setCustomConsoleComponentButtonText(s.t("connect.connecting")),t.console.setCustomConsoleComponentButtonStyle("background: black;"),t.console.setCustomConsoleComponentButtonStyle("color: white;}");break;case"connected":console.log(d+"Connected"),t.console.setCustomConsoleComponentButtonText(s.t("connect.connected")),t.console.setCustomConsoleComponentButtonStyle("background:#3bff3b;"),t.console.setCustomConsoleComponentButtonStyle("color:black;"),c.initialize(i);break;case"not connected":console.log(d+"Not Connected"),t.console.setCustomConsoleComponentButtonText(s.t("connect.notConnected")),t.console.setCustomConsoleComponentButtonStyle("color:black;"),t.console.setCustomConsoleComponentButtonStyle("background:#ff3b3b;")}}),o.initialize(S)})}function u(e){var n=C(e,"ConnectorSettings","PollPort","5050"),o=C(e,"ConnectorSettings","UseLocalHost","true")==="true",t=C(e,"PopSettings","ShowContact","true")==="true",s=C(e,"PopSettings","NoDefaultSearch","false")==="true",a=C(e,"PopSettings","NoANISearch","false")==="true",l=C(e,"CaseSettings","ShowCase","false")==="true",c=C(e,"CaseSettings","NewCaseOnPop","false")==="true",i=C(e,"CaseSettings","NewCaseIfNoSearchKVPPresent","false")==="true",r=C(e,"CaseSettings","SearchCaseIfWrongCase","false")==="true",u=C(e,"CaseSettings","OpenNewCaseInEditMode","false")==="true",g=C(e,"CaseSettings","OpenExistingCaseInEditMode","false")==="true",p=C(e,"TaskSettings","CreateTask","false")==="true",S=C(e,"TaskSettings","NewTaskOnPop","false")==="true",d=C(e,"TaskSettings","OpenInitialTaskInEditMode","false")==="true",f=C(e,"TaskSettings","OpenFinalTaskInEditMode","false")==="true",h=C(e,"DataMapping","CaseMap",""),m=C(e,"DataMapping","TaskMap",""),k=C(e,"DataMapping","DispositionKVP");return{pollPort:n,useLocalHost:o,showContact:t,noDefaultSearch:s,noANISearch:a,showCase:l,newCaseOnPop:c,searchCaseIfWrongCase:r,newCaseIfNoSearchKVPPresent:i,openNewCaseInEditMode:u,openExistingCaseInEditMode:g,createTask:p,newTaskOnPop:S,openInitialTaskInEditMode:d,openFinalTaskInEditMode:f,caseMap:h,taskMap:m,dispositionKVP:k}}function C(e,n,o,t){var s=e["/"+n+"/"+o];return s?(console.log("getOption: "+n+" "+o+": "+s),s):(console.log("getOption: "+n+" "+o+" (default): "+t),t)}function g(e,n,o){return C(e,"FieldSearchSettings",n,o)}function p(e){return{voiceSearchType:g(e,"VoiceSearchType","phoneNumber"),emailSearchType:g(e,"EmailSearchType","email"),chatSearchType:g(e,"ChatSearchType","name"),openmediaSearchType:g(e,"OpenMediaSearchType","name"),searchCaseKVP:g(e,"SearchCaseKVP","CaseNumber")}}var S,d="SFDC/sfdc: ",f=!1,h=function(n){var o=e.Deferred();try{console.log(d+"initialize ("+n+")");var c=window.navigator.userLanguage||window.navigator.language;console.log(d+"lang="+c),f?t.console.isInConsole()&&(console.log(d+"in console"),r(),o.resolve()):s.use(l).init({debug:!0,lng:c,fallbackLng:"en",backend:{loadPath:n+"locales/{{lng}}.json"}},function(){a.init(s,e),f=!0,e("body").localize(),i.initialize(),t.console.isInConsole()?(console.log(d+"in console"),r(),o.resolve(s)):(console.log(d+"NOT in Salesforce console."),o.reject())})}catch(u){console.error(d+"ERROR - "+u.stack),o.reject()}return o.promise()},m=function(){console.log(d+"terminate"),o.terminate()};return{initialize:h,terminate:m}})