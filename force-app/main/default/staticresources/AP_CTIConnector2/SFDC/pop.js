define(["util","integration","config","SFDC/tracking","SFDC/case","SFDC/task","agent/interaction"],function(n,t,o,e,a,c,r){var i="SFDC/pop: ",s=function(n){console.log(i+"start");var s=n.ixn,l=n.contact,u=function(t){t===null||t.success||(console.warn("could not open pop tab"),t=null),t!==null&&console.log(i+"tab id is "+t.id),e.add(s.id,t!==null?t.id:null,l);var o={Action:"AttachData",ActionData:{id:s.id,userData:{sfdcObjectId:s.id}}};r.attachData(o),a.pop(n).then(function(t){return e.setWhatId(s.id,t),n.caseId=t,c.start(n)},function(){return c.start(n)})};o.overridePop?o.overridePop(n):o.SHOW_CONTACT&&l?(console.log(i+"attempt to refresh first"),t.console.refreshPrimaryTabByName(l.Id,!0,function(n){n.success?(console.log(i+"refresh successful"),t.console.getFocusedPrimaryTabId(function(t){n.id=t.id,u(n)})):(console.log(i+"couldn't refresh so open primary tab"),t.console.openPrimaryTab(null,"/"+l.Id,!0,l.Name,function(n){u(n)},l.Id))})):u(null)};return{start:s}})