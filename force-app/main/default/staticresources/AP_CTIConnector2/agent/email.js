define(["util","moment","config"],function(e){var a="agent/email: ",s=function(s){console.log(a+s.messageType);try{if(s.messageType==="EmailStateChangeMessage"&&s.notificationType==="StatusChange")switch(console.log(a+"id - "+s.email.id),console.log(a+"state - "+s.email.state),s.email.mediaType="email",s.email.state){case"Processing":console.log(a+"publish email.pop"),e.getInstance("email.pop").publish(s);break;case"Completed":console.log(a+"publish email.ended"),e.getInstance("email.ended").publish(s)}}catch(i){console.error(a+"ERROR - "+i.message)}};return{onMessage:s}})