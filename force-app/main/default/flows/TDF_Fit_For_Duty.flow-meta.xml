<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>assSet_Response_to_No</name>
        <label>Set Response to No</label>
        <locationX>712</locationX>
        <locationY>397</locationY>
        <assignmentItems>
            <assignToReference>sobWorkOrder.Fit_For_Duty_Response__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>No</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>assSet_Status</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>assSet_Response_to_Yes</name>
        <label>Set Response to Yes</label>
        <locationX>440</locationX>
        <locationY>291</locationY>
        <assignmentItems>
            <assignToReference>sobWorkOrder.Fit_For_Duty_Response__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Yes</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>ruSet_SR_Fields_FFD_Comp</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>assSet_Status</name>
        <label>Set Status Complete</label>
        <locationX>710</locationX>
        <locationY>293</locationY>
        <assignmentItems>
            <assignToReference>sobWorkOrder.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varStatus</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sobWorkOrder.Previous_Duty_End__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>dtPrevDutyEnd</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Save_Fit_For_Duty_Reponse</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>chAssNo</name>
        <choiceText>No</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>N</stringValue>
        </value>
    </choices>
    <choices>
        <name>chAssYes</name>
        <choiceText>Yes</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Y</stringValue>
        </value>
    </choices>
    <choices>
        <name>choConfirm</name>
        <choiceText>Confirm</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Confirm</stringValue>
        </value>
    </choices>
    <choices>
        <name>choReEnter</name>
        <choiceText>Re-enter</choiceText>
        <dataType>String</dataType>
    </choices>
    <decisions>
        <name>decFFD_Fail_Confirmed</name>
        <label>FFD Fail Confirmed</label>
        <locationX>279</locationX>
        <locationY>498</locationY>
        <defaultConnector>
            <targetReference>scnFit_For_Duty_Questions</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Reenter</defaultConnectorLabel>
        <rules>
            <name>Confirmed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Fit_For_Duty_Confirmation</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Confirm</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>scrFit_For_Duty_Failed2</targetReference>
            </connector>
            <label>Confirmed</label>
        </rules>
    </decisions>
    <decisions>
        <name>decFFD_Failed</name>
        <label>FFD Failed?</label>
        <locationX>276</locationX>
        <locationY>289</locationY>
        <defaultConnector>
            <targetReference>assSet_Response_to_Yes</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Passed</defaultConnectorLabel>
        <rules>
            <name>outFail</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>fldAssResponse</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>chAssNo</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>scrFit_For_Duty_Failed</targetReference>
            </connector>
            <label>Failed</label>
        </rules>
    </decisions>
    <description>Flow to complete Transport Fit For Duty check. JI adjust. Set FFD. Clear SR.RB1End. Set PrevDutyEnd. Display Time since PrevDuty. Set Gantt Label</description>
    <interviewLabel>TDF_Fit_For_Duty{!$Flow.CurrentDateTime}</interviewLabel>
    <label>TDF Fit For Duty</label>
    <processType>FieldServiceMobile</processType>
    <recordLookups>
        <name>flFast_Lookup_Work_Order</name>
        <label>Fast Lookup Work Order</label>
        <locationX>15</locationX>
        <locationY>22</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>ruSet_SA_Start</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>sobWorkOrder</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Record_Type_Name__c</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>Fit_For_Duty_Response__c</queriedFields>
        <queriedFields>User_Full_Name__c</queriedFields>
        <queriedFields>Job_Instructions__c</queriedFields>
        <queriedFields>Duty_Template_Name__c</queriedFields>
        <queriedFields>Rest_Break_2_End__c</queriedFields>
        <queriedFields>Previous_Duty_End__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>rlGet_Prev_Duty_End</name>
        <label>Get Prev Duty End</label>
        <locationX>15</locationX>
        <locationY>201</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>scnFit_For_Duty_Questions</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varSRId</elementReference>
            </value>
        </filters>
        <object>ServiceResource</object>
        <outputAssignments>
            <assignToReference>dtPrevDutyEnd</assignToReference>
            <field>Duty_End__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varTimeSincePrevDutyEnd</assignToReference>
            <field>Time_Since_Duty_End__c</field>
        </outputAssignments>
    </recordLookups>
    <recordUpdates>
        <name>ruSet_SA_End</name>
        <label>Set SA End</label>
        <locationX>1016</locationX>
        <locationY>292</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>ActualEndTime</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>ServiceAppointment</object>
    </recordUpdates>
    <recordUpdates>
        <name>ruSet_SA_Start</name>
        <label>Set SA Start</label>
        <locationX>14</locationX>
        <locationY>112</locationY>
        <connector>
            <targetReference>rlGet_Prev_Duty_End</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>ActualStartTime</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>ServiceAppointment</object>
    </recordUpdates>
    <recordUpdates>
        <description>Set FFD Passed Date Time and Id
Reset Rest Break In Progress to False*
Clear out SR.Rest Break 1 End (note that flow doesnt allow setting date to null, so using WO.Rest_Break_2_End__c (which will be null at this stage) as a work around

*This is cater for scenario where prior Duty ended with a Rest Break in progress.</description>
        <name>ruSet_SR_Fields_FFD_Comp</name>
        <label>Set SR Fields</label>
        <locationX>574</locationX>
        <locationY>293</locationY>
        <connector>
            <targetReference>assSet_Status</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varSRId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>FSL__GanttLabel__c</field>
            <value>
                <elementReference>sobWorkOrder.Duty_Template_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Fit_For_Duty_Passed__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Fit_For_Duty_Work_Order__c</field>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Rest_Break_1_End__c</field>
            <value>
                <elementReference>sobWorkOrder.Rest_Break_2_End__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Rest_Break_In_Progress__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>ServiceResource</object>
    </recordUpdates>
    <recordUpdates>
        <name>Save_Fit_For_Duty_Reponse</name>
        <label>Save Fit For Duty Reponse</label>
        <locationX>862</locationX>
        <locationY>293</locationY>
        <connector>
            <targetReference>ruSet_SA_End</targetReference>
        </connector>
        <inputReference>sobWorkOrder</inputReference>
    </recordUpdates>
    <screens>
        <name>scnFit_For_Duty_Questions</name>
        <label>Fit For Duty Questions</label>
        <locationX>13</locationX>
        <locationY>287</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>scnFit_For_Duty_Response</targetReference>
        </connector>
        <fields>
            <name>txtFFDQAll</name>
            <fieldText>Duty: {!sobWorkOrder.Duty_Template_Name__c}

Time Since Previous Duty End:
{!varTimeSincePrevDutyEnd}

Instructions: 
{!sobWorkOrder.Job_Instructions__c}

Question 1:
I have completed my daily fitness for work self-assessment.

Question 2:
I have had the required rest break prescribed by Work/Rest legislation.

Question 3:
I have informed my supervisor of any secondary employment I am undertaking that my impact on my duties.

Question 4:
I am not under the influence of any illicit drugs or alcohol.

Question 5:
I have informed my supervisor of any prescription or over the counter medication I am taking that may impact my ability to carry out my duties.

Question 6:
I am in possession of a current and valid driver’s license &amp; I have declared any infringements that may impact my legal ability to drive.

Question 7:
I am in possession of my National Driver Work Diary where I am legally required to carry one.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scnFit_For_Duty_Response</name>
        <label>Fit For Duty Response</label>
        <locationX>144</locationX>
        <locationY>288</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>decFFD_Failed</targetReference>
        </connector>
        <fields>
            <name>txtAssestation</name>
            <fieldText>I, {!sobWorkOrder.User_Full_Name__c}, agree that I  comply with all Fit for Duty questions.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>fldAssResponse</name>
            <choiceReferences>chAssYes</choiceReferences>
            <choiceReferences>chAssNo</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Response</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrFit_For_Duty_Failed</name>
        <label>Fit For Duty Failed</label>
        <locationX>277</locationX>
        <locationY>397</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>decFFD_Fail_Confirmed</targetReference>
        </connector>
        <fields>
            <name>txtFFDFailMsg</name>
            <fieldText>You have indicated that you are not Fit for Duty. As a result, you do not comply with this requirement.

Please click &apos;Confirm&apos; to confirm you are not Fit for Duty, or &apos;Re-enter&apos; to review your response.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Fit_For_Duty_Confirmation</name>
            <choiceReferences>choConfirm</choiceReferences>
            <choiceReferences>choReEnter</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Fit For Duty Confirmation</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrFit_For_Duty_Failed2</name>
        <label>Fit For Duty Failed</label>
        <locationX>713</locationX>
        <locationY>498</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>assSet_Response_to_No</targetReference>
        </connector>
        <fields>
            <name>txtFFDFailed</name>
            <fieldText>You have confirmed that you are NOT Fit for Duty. As a result, you cannot continue further. Please advise your supervisor immediately.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>flFast_Lookup_Work_Order</startElementReference>
    <status>Active</status>
    <variables>
        <name>DebugFlag</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Y</stringValue>
        </value>
    </variables>
    <variables>
        <name>dtPrevDutyEnd</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <value>
            <stringValue>0WO0l0000004Vyc</stringValue>
        </value>
    </variables>
    <variables>
        <name>sobWorkOrder</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
    <variables>
        <name>varSRId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varTimeSincePrevDutyEnd</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
