<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>assSet_Completed</name>
        <label>Set Completed</label>
        <locationX>24</locationX>
        <locationY>457</locationY>
        <assignmentItems>
            <assignToReference>varStatus</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>ruSet_SA_End</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_In_Progress</name>
        <label>Set In Progress</label>
        <locationX>208</locationX>
        <locationY>138</locationY>
        <assignmentItems>
            <assignToReference>varStatus</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>In Progress</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>ruSet_WO_In_Progess</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>chAssNo</name>
        <choiceText>No</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>N</stringValue>
        </value>
    </choices>
    <choices>
        <name>chAssYes</name>
        <choiceText>Yes</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Y</stringValue>
        </value>
    </choices>
    <choices>
        <name>choConfirm</name>
        <choiceText>Confirm</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Confirm</stringValue>
        </value>
    </choices>
    <choices>
        <name>choFail</name>
        <choiceText>Fail</choiceText>
        <dataType>String</dataType>
    </choices>
    <choices>
        <name>choNo</name>
        <choiceText>No</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>N</stringValue>
        </value>
    </choices>
    <choices>
        <name>choNot_safe</name>
        <choiceText>Not safe for use</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>NotSafe</stringValue>
        </value>
    </choices>
    <choices>
        <name>choPass</name>
        <choiceText>Pass</choiceText>
        <dataType>String</dataType>
    </choices>
    <choices>
        <name>choReEnter</name>
        <choiceText>Re-enter</choiceText>
        <dataType>String</dataType>
    </choices>
    <choices>
        <name>choSafe</name>
        <choiceText>Safe for operational use</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Safe</stringValue>
        </value>
    </choices>
    <choices>
        <name>choYes</name>
        <choiceText>Yes</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Y</stringValue>
        </value>
    </choices>
    <decisions>
        <description>If vehicle check has failed (i.e. returns Critical) then leave WO in progress for check of next vehicle, and set PDC Copy flag to trigger a copy of the failed job for reference (via trigger TDF_WorkOrderTrigger). 
Else if passed (Non Critical), complete job.
Else other (e.g. ended due to Faulted vehicle), then just end</description>
        <name>decCheck_Status</name>
        <label>Check Status</label>
        <locationX>28</locationX>
        <locationY>349</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>outCritical</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>varCheckStatus</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Failed - Critical Issue</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>ruSet_PDC_Copy_True</targetReference>
            </connector>
            <label>Failed</label>
        </rules>
        <rules>
            <name>outNon_Critiical</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>varCheckStatus</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Passed - Non Critical Issue</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varCheckStatus</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Passed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>assSet_Completed</targetReference>
            </connector>
            <label>Passed</label>
        </rules>
    </decisions>
    <decisions>
        <name>decCurrent_Status</name>
        <label>Current Status</label>
        <locationX>28</locationX>
        <locationY>133</locationY>
        <defaultConnector>
            <targetReference>Set_In_Progress</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>outInProgress</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>sobWorkOrder2.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>In Progress</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Launch_Vehicle_Check</targetReference>
            </connector>
            <label>In Progress</label>
        </rules>
    </decisions>
    <description>Flow to process Transport Pre Departure. Calls Vehicle check. Remove set WO to Completed</description>
    <interviewLabel>TDF_Pre_Departure_Check {!$Flow.CurrentDateTime}</interviewLabel>
    <label>TDF_Pre_Departure_Check</label>
    <processType>FieldServiceMobile</processType>
    <recordLookups>
        <name>flFast_Lookup_Work_Order</name>
        <label>Fast Lookup Work Order</label>
        <locationX>27</locationX>
        <locationY>17</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>scrInstructions</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>sobWorkOrder2</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>Job_Instructions__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>ruSet_PDC_Copy_False</name>
        <label>Set PDC Copy False</label>
        <locationX>359</locationX>
        <locationY>18</locationY>
        <connector>
            <targetReference>decCurrent_Status</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>PDC_Copy__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>WorkOrder</object>
    </recordUpdates>
    <recordUpdates>
        <description>Set field PDC Copy to true.  This will be detected by TDF_WorkOrderTrigger to call TDF_WorkOrderTriggerUtility.workOrderUpdateMethod to perform PDC check while In Progress. This allows the current PDC to be reused for a new check.</description>
        <name>ruSet_PDC_Copy_True</name>
        <label>Set PDC Copy True</label>
        <locationX>238</locationX>
        <locationY>350</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>PDC_Copy__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>WorkOrder</object>
    </recordUpdates>
    <recordUpdates>
        <name>ruSet_SA_End</name>
        <label>Set SA End</label>
        <locationX>239</locationX>
        <locationY>456</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>ActualEndTime</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>ServiceAppointment</object>
    </recordUpdates>
    <recordUpdates>
        <name>ruSet_SA_Start</name>
        <label>Set SA Start</label>
        <locationX>362</locationX>
        <locationY>241</locationY>
        <connector>
            <targetReference>Launch_Vehicle_Check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>ActualStartTime</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>ServiceAppointment</object>
    </recordUpdates>
    <recordUpdates>
        <name>ruSet_WO_In_Progess</name>
        <label>Set WO In Progess</label>
        <locationX>364</locationX>
        <locationY>142</locationY>
        <connector>
            <targetReference>ruSet_SA_Start</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>In Progress</stringValue>
            </value>
        </inputAssignments>
        <object>WorkOrder</object>
    </recordUpdates>
    <screens>
        <name>scrInstructions</name>
        <label>Instructions</label>
        <locationX>199</locationX>
        <locationY>19</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>ruSet_PDC_Copy_False</targetReference>
        </connector>
        <fields>
            <name>txtInstructions</name>
            <fieldText>Job Instructions: 
{!sobWorkOrder2.Job_Instructions__c}

General Instructions:
All drivers are legally responsible for the safety of the vehicles they drive. Before driving any vehicle you must ensure it is safe. If your vehicle is unsafe, you are not only putting your own safety at risk, but also the safety of other road users and the general public.

- Areas of the vehicle requiring inspection are listed.
- Complete inspection of your allocated vehicle.
- If an area fails inspection, de-select the switch to record a failure against that item.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>flFast_Lookup_Work_Order</startElementReference>
    <status>Active</status>
    <subflows>
        <name>Launch_Vehicle_Check</name>
        <label>Launch Vehicle Check</label>
        <locationX>27</locationX>
        <locationY>242</locationY>
        <connector>
            <targetReference>decCheck_Status</targetReference>
        </connector>
        <flowName>TDF_Vehicle_Check</flowName>
        <inputAssignments>
            <name>Id</name>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varMode</name>
            <value>
                <stringValue>PDC</stringValue>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>Id</assignToReference>
            <name>Id</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varCheckStatus</assignToReference>
            <name>varCheckStatus</name>
        </outputAssignments>
    </subflows>
    <variables>
        <name>Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <value>
            <stringValue>0WO0l0000004W2W</stringValue>
        </value>
    </variables>
    <variables>
        <name>sobWorkOrder2</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
    <variables>
        <name>varCheckStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <stringValue>varStatus</stringValue>
        </value>
    </variables>
</Flow>
