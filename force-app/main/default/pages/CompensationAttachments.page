<!--
    @author Hasantha Liyanage
    @date 2023-07-17
    @group VisualForce
    @tag Controller
    @tag Attachments
    @domain ui
    @description Support attachments for compensation record in console level
    @changelog
    2023-07-17 - hasantha.liyanage@auspost.com.au - Created
 -->

<apex:page id="CompensationAttachments" standardStylesheets="true" standardController="Compensation__c"
           extensions="EFTBankDetailsController">
    <apex:includeLightning/>
    <c:ScriptLoader jsLibraries="integration,jquery" csslibraries="ssswconsole"/>
    <div id="content">
        <div id="lightningComponent"/>
    </div>
    <body class="slds-scope">
    <div id="wrapper">
        <c:LightningWrapper lightningApp="c:CompensationAttachmentsApp"
                            lightningComponent="c:CompensationAttachmentsContainer"
                            crossOriginLwcEvents="preview"
                            crossOriginSupport="true"
                            componentAttributes="{&quot;recordId&quot;:&quot;{!record.id}&quot;}"/>
    </div>
    </body>
    <script>

        jQuery(function ($) {
            // define our dom events we will receive from the Happy Parcels lightning component
            document.getElementById('wrapper').addEventListener('preview', handlePreview);

        });

        function handlePreview(e) {
            previewFile(e.detail);
        }

        function previewFile(detail) {
            var redirectUrl;
            if (detail.isAttachment === true) {
                redirectUrl = "/servlet/servlet.FileDownload?file=" + detail.attachmentId;
            } else {
                redirectUrl = detail.attachmentId;
            }

            if (sforce.console.isInConsole()) {
                sforce.console.getEnclosingTabId(function (enclosingResult) {
                    sforce.console.getEnclosingPrimaryTabId(function (primaryResult) {
                        sforce.console.openSubtab(primaryResult.id, redirectUrl, true, '', null);
                    });
                });
            } else {
                window.top.location.href = '/' + redirectUrl
            }
        }

    </script>
</apex:page>
